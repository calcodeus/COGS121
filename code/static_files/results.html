<html>

<head>
  <title>Anime Noobs</title>
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->



  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
  <script src="jquery-3.3.1.min.js"></script>

  <link rel="stylesheet" href="css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">

  <script src="jquery-3.3.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="fastclick.min.js"></script>
  <script src="jquery.min.js"></script>

  <script src="cytoscape.min.js"></script>

  <script src="jquery.qtip.min.js"></script>
  <link href="jquery.qtip.min.css" rel="stylesheet" type="text/css" />
  <script src="cytoscape-qtip.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore.js" type="text/javascript"></script>

  <script src="bluebird.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="typeahead.bundle.js"></script>
  <script src="handlebars.min.js"></script>
  <script src="lodash.min.js"></script>

  <script src="demo.js"></script>
  <!-- wine and cheese links  -->
  <link href="font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="bootstrap-3.3.7-dist/css/bootstrap.min.css">
  <link href="style.css" rel="stylesheet">
  <link rel="shortcut icon" type="image/png" href="icon.png">
  <!-- end wine and cheese notes  -->

  <script type="text/javascript">
    let favorites = {};
    let keywordList = {};
    const combined = [];
    let genreList = {};
    let recommendations = {};

    function recFor(type, id) {
      const requestURL = 'recommend/' + type + '/' + id;
      //console.log('making ajax request to:', requestURL);
      return $.get(requestURL);
    }

    function keywordSearch() {
      const defList = [];
      Object.keys(keywordList).forEach((k) => {
        //console.log(k);
        defList.push(recFor('Keyword', k));
      });
      Object.keys(genreList).forEach((g) => {
        //console.log(g);
        defList.push(recFor('Genre', g));
      });
      return defList;
    }

    function fakeRecs() {
      let i = 0;
      while (i < 30) {
        i = i + 1;
        if (i >= Object.keys(favorites).length) {
          console.log('not enough favorites!');
          break;
        }
        favorites[Object.keys(favorites)[i]].keyword_ids.forEach((kid) => {

          const requestURL = 'recommend/Keyword/' + kid;
          //console.log('hitting: ' + requestURL);
          $.get(requestURL, (data) => {
            if (data != []) {
              //console.log(data);
            }
            data.forEach((d) => {
              const getMovieURL = 'getMovie/' + d;
              const recList = [];
              $.get(getMovieURL, (title) => {
                if (!recommendations[title.id]) {
                  recommendations[title.id] = title;
                  recList.push(title);
                  sessionStorage.recList = JSON.stringify(recList);
                  const loc = recList.length - 1;
                  DisplayRec(title, loc);
                }
              });
            });
          });
        });
      }
    }

    function DisplayRec(title, number) {
      return;
      if (!title) {
        console.log('shits broke');
      }
      if (!title.poster_path) {
        console.log('no poster for obj');
        console.dir(title);

      }
      let resultsField = '';
      const name = title.title;
      //console.log(name);
      const poster = title.poster_path;
      const pre = '<div class="col-sm-4" style="text-align:center; padding-bottom: 30px;"><img class="poster" src=http://image.tmdb.org/t/p/w185/';
      const mid = ' alt=""><br><a href="mediaPage.html#' + number + '">';
      const post = '</a></div><br>';
      resultsField += pre + poster + mid + name + post;
      let resultDiv = document.getElementById('results');

      resultDiv.insertAdjacentHTML('beforeend', resultsField);
    }


    function SetupLists(favs) {
      //console.log(typeof favs);
      console.dir(favs);
      Object.keys(favs).forEach((id) => {
        const favorite = favs[id];
        favorite.genre_ids.forEach((gi) => {
          if (!genreList[gi]) {
            genreList[gi] = {
              id: gi,
              score: 0,
              basis: []
            }
          }
          genreList[gi].score += 1;
          genreList[gi].basis.push(id);
        });
        favorite.keyword_ids.forEach((ki) => {
          if (!keywordList[ki.id]) {
            keywordList[ki.id] = {
              id: ki.id,
              name: ki.name,
              score: 0,
              basis: []
            }
          }
          keywordList[ki.id].score += 1;
          keywordList[ki.id].basis.push(id);
        });
      });
      //console.dir(keywordList);
      //console.dir(genreList);
    }

    // jQuery convention for running when the document has been fully loaded:
    $(document).ready(() => {
      //console.log('favorites: ');
      //console.log(typeof favorites);
      //console.dir(favorites);
      $('#next').click(() => {
        //LoadRecs();
      });
      $('#previous').click(() => {
        //LoadRecs();
      });

      // define a generic Ajax error handler:
      // http://api.jquery.com/ajaxerror/
      $(document).ajaxError(() => {
        $('#status').html('Error: unknown ajaxError!');
      });
    });
  </script>
  <style>
    #page {
      max-margin-left: 20%;
      max-margin-right: 20%;
    }

    .slider {
      -webkit-appearance: none;
      width: 20%;
      height: 15px;
      border-radius: 5px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #4CAF50;
      cursor: pointer;
    }

    .poster {
      height: 20vh;
    }

    #ratingContainer {
      margin-left: 40px;
      margin-right: 40px;
    }
  </style>
</head>

<body style="background-color: #000;">

  <!-- <div id="results"> -->

  <center style="position: relative;">
    <h1 style="color: #fff; position: relative;">Recommendations</h1>
    <a href="homepage.html" class="btn btn-default" style="width: 3em;margin: 0.5em;position: relative; padding: 6px 12px; color: #000"><i class="fas fa-home"></i></a>
    <a href="favorites.html" class="btn btn-default" style="width: 3em;margin: 0.5em;position: relative; padding: 6px 12px; color: #000"><i class="fas fa-star"></i></a>
    <button id="reset" class="btn btn-default" style="width: 3em;margin: 0.5em;position: relative; padding: 6px 12px; color: #000"><i class="fa fa-arrows-h"></i></button>
  </center>

  <div class="row">
    <!-- <div class="col-md-6"> -->
    <div id="loading">
      <span class="fa fa-refresh fa-spin"></span>
    </div>

    <div class="column" style="width: 35%">
      <div id="info"></div>
      <div id="bookmarks" style="display: block">
        <center>
          <h2 style="color: #fff; position: relative;">Bookmarks</h1>
        </center>
      </div>
    </div>
    <div class="column" style="min-width: 65%; max-width:100%; max-height:100%">
      <div id="cy"></div>
    </div>




    <!-- </div> -->
  </div>






  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-155159-12', 'auto');
    ga('send', 'pageview');
  </script>




  <!-- <center>
    <div class="slidecontainer">
      Action <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
      <button id="delete"><i class="fas fa-times"></i></button>
    </div>
  </center> -->
  </div>
</body>

</html>
